generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  CUSTOMER
}

enum OrderStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ServiceCategory {
  FOTOGRAFIA
  PLANOS
  VIDEO
}

enum Zone {
  CABA
  GBA
}

enum PropertyType {
  CASA
  DEPARTAMENTO
  OFICINA
  LOCAL
  TERRENO
}

enum QuestionInputType {
  TEXT
  NUMBER
  SELECT
  RADIO
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      Role     @default(CUSTOMER)
  orders    Order[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Service {
  id          String          @id @default(uuid())
  name        String
  description String
  category    ServiceCategory
  basePrice   Float
  questions   Question[]
  orders      OrderService[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model Order {
  id           String          @id @default(uuid())
  status       OrderStatus     @default(PENDING)
  address      String
  propertySize String? // ej: "100m2"
  zone         Zone?
  propertyType PropertyType?
  roomCount    Int?              // Cantidad de ambientes
  amenities    String?           // Selección de amenities
  details      String?
  totalPrice   Float?            // Precio estimado calculado al crear el pedido
  customerId   String
  customer     User            @relation(fields: [customerId], references: [id])
  services     OrderService[]
  responses    OrderResponse[]
  notifications Notification[]
  review       Review?
  gbaSubzone   String?           // Partido del AMBA/GBA
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}

model OrderService {
  id        String   @id @default(uuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  serviceId String
  service   Service  @relation(fields: [serviceId], references: [id])
  createdAt DateTime @default(now())

  @@unique([orderId, serviceId])
}

model Notification {
  id        String   @id @default(uuid())
  type      String   // 'NEW_ORDER', etc.
  message   String
  orderId   String?
  order     Order?   @relation(fields: [orderId], references: [id])
  isRead    Boolean  @default(false)
  emailSent Boolean  @default(false)
  createdAt DateTime @default(now())
}


model Question {
  id           String            @id @default(uuid())
  text         String
  inputType    QuestionInputType
  pricingBaseUnits  Float?        // Unidades incluidas en precio base (ej: 100 m²)
  pricingStepSize   Float?        // Tamaño del paso (ej: 10 m²)
  pricingStepPrice  Float?        // Precio por cada paso extra
  dependsOnOptionId String?       // ID de opción que activa esta pregunta
  displaySection    Int           @default(2) // 1 = Inmueble, 2 = Detalles
  serviceId    String?
  service      Service?          @relation(fields: [serviceId], references: [id])
  displayOrder Int               @default(0)
  isRequired   Boolean           @default(true)
  isActive     Boolean           @default(true)
  options      QuestionOption[]
  responses    OrderResponse[]
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
}

model QuestionOption {
  id            String          @id @default(uuid())
  questionId    String
  question      Question        @relation(fields: [questionId], references: [id])
  label         String
  description   String?
  priceModifier Float           @default(0)
  responses     OrderResponse[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model OrderResponse {
  id         String          @id @default(uuid())
  orderId    String
  order      Order           @relation(fields: [orderId], references: [id])
  questionId String
  question   Question        @relation(fields: [questionId], references: [id])
  optionId   String? // Usado para SELECT y RADIO
  option     QuestionOption? @relation(fields: [optionId], references: [id])
  textValue  String? // Usado para TEXT y NUMBER
  createdAt  DateTime        @default(now())
}

model PortfolioProject {
  id          String            @id @default(uuid())
  title       String
  description String?
  category    ServiceCategory?
  isActive    Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  images      PortfolioImage[]
}

model PortfolioImage {
  id           String            @id @default(uuid())
  projectId    String
  project      PortfolioProject  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String            // URL pública de R2
  caption      String?           // Mini título o descripción de la imagen individual
  displayOrder Int               @default(0)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
}

model Faq {
  id           String   @id @default(uuid())
  question     String
  answer       String
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Review {
  id          String   @id @default(uuid())
  orderId     String   @unique
  order       Order    @relation(fields: [orderId], references: [id])
  token       String   @unique  // Token para el enlace de valoración
  rating      Int      // 1-5
  comment     String?
  authorName  String
  isApproved  Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model GbaSubzoneConfig {
  id          String   @id @default(uuid())
  name        String   @unique  // Nombre del partido
  isEnabled   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
